<div>

  <!-- Ultra-ghetto 1990s-style table formatting for now -->
  <table width="100%">
    <tr>
      <td width="300px" style="vertical-align:top">
        <filter-sidebar></filter-sidebar>
      </td>

      <td style="vertical-align:top">
        <h1>Results ({{ numMatchingStudies }} studies, {{ numMatchingSamples }} samples)</h1>
        <div>
          <span *ngIf="!ready" style="color: red;font-style: italic">Updating results...</span>
          <span *ngIf="ready" style="color: grey;font-style: italic">Results up-to-date</span>
        </div>
        <span *ngIf="(numExcludedStudies > 0) || (numExcludedSamples > 0)" style="color: red;font-style: italic;">Explicitly excluding {{ numExcludedStudies }} studies and {{ numExcludedSamples }} samples from download</span>
        <ul>
          <li *ngFor='let studyMatch of matches'>
            <input type="checkbox"
                   [checked]="isStudySelected(studyMatch.studyId)"
                   (change)="updateStudySelection($event, studyMatch.studyId)"/>
            <a (click)="selectStudy(studyMatch.study)" href="javascript:void(0)">
              <b>{{ studyMatch.study._source['STUDY']['Study Title'] }}</b>
            </a>
            <i>by {{ studyMatch.study._source['STUDY']['Study Researchers Involved'] }}</i>
            <pubmed-links [study]="studyMatch.study"></pubmed-links>
            <doi-links [study]="studyMatch.study"></doi-links>
            <br/>
            <b>{{ studyMatch.sampleMatches.length }} matching samples</b>
            <button (click)="areSamplesHidden[studyMatch.studyId] = !areSamplesHidden[studyMatch.studyId]">Show/Hide</button>
            <ul *ngIf="!areSamplesHidden[studyMatch.studyId]">
              <li *ngFor="let sampleMatch of sortSampleMatches(studyMatch.sampleMatches)">
                <div class="showonhover">
                  <input type="checkbox"
                         [checked]="isSampleSelected(sampleMatch.sampleId)"
                         (change)="updateSampleSelection($event, sampleMatch.sampleId)"/>
                  <b>{{ sampleMatch.sample._source['Sample Name'] }}</b>
                  <span *ngFor="let kv of filteredDistinctKeyValues(studyMatch.studyId, sampleMatch.sample) | mapToIterable; let isLast = last">
                    <i>{{ kv.key }}</i>: {{ kv.val }}<span *ngIf="!isLast">, </span>
                  </span>


                  <div class="hovertext">
                    <div *ngFor="let kv of distinctKeyValues(studyMatch.studyId, sampleMatch.sample) | mapToIterable">
                      <b>{{ kv.key }}</b>: {{ kv.val }}
                    </div>
                  </div>
                </div>
              </li>
            </ul>
          </li>
        </ul>
      </td>
    </tr>
  </table>
</div>
