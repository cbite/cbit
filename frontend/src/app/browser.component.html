<div class="container-fluid">
  <div class="row">
    <div class="col-xs-3 sidebar">
      <filter-sidebar></filter-sidebar>
    </div>

    <div class="col-xs-9 col-xs-offset-3 main">
      <div class="h1">
        Results ({{ numMatchingStudies }} studies, {{ numMatchingSamples }} samples)
        <spinner *ngIf="!ready"></spinner>
      </div>
      <div>
        In download cart: {{ numStudiesInCart }} studies, {{ numSamplesInCart }} samples.
        <button (click)="clearCart()">Clear Cart</button>
        <button (click)="addCurrentSelectionToCart()">Add Selection To Cart</button>
        <button (click)="proceedToDownload()">Proceed to Download</button>
        <span *ngIf="(numExcludedStudies > 0) || (numExcludedSamples > 0)" style="color: red;font-style: italic;">
            Explicitly excluding {{ numExcludedStudies }} studies and {{ numExcludedSamples }} samples from download
            <button (click)="clearExclusions()">Clear Exclusions</button>
          </span>
      </div>

      <div class="row">

        <div *ngFor='let studyMatch of matches' class="col-md-4">
          <div class="panel panel-default">
            <div class="panel-heading">
              <input type="checkbox"
                     [checked]="isStudySelected(studyMatch.study._id)"
                     (change)="updateStudySelection($event, studyMatch.study._id)"/>

              <a (click)="selectStudy(studyMatch.study)" href="javascript:void(0)">
                <h3 class="panel-title" style="float:left;width:80%">{{ studyMatch.study._source['STUDY']['Study Title'] }}</h3>
              </a>

              <div style="float:right">
                <a href="#" class="btn btn-default btn-xs" role="button"><span class="glyphicon glyphicon-plus"></span></a>
              </div>
              <div class="clearfix"></div>
            </div>
            <div class="panel-body">
              <p>by {{ studyMatch.study._source['STUDY']['Study Researchers Involved'] }}</p>

              <a (click)="areSamplesShown[studyMatch.study._id] = !areSamplesShown[studyMatch.study._id]" href="javascript:void(0)">
                <span *ngIf=" !areSamplesShown[studyMatch.study._id]" class="glyphicon glyphicon-triangle-right"></span>
                <span *ngIf="!!areSamplesShown[studyMatch.study._id]" class="glyphicon glyphicon-triangle-bottom"></span>
                {{ studyMatch.sampleMatches.length }} matching samples
              </a>

              <div [collapse]="!areSamplesShown[studyMatch.study._id]">
                <ul style="list-style: none">
                  <li *ngFor="let sampleMatch of sortSampleMatches(studyMatch.sampleMatches)">
                    <div class="showonhover">
                      <a href="javascript:void(0)" class="btn btn-default btn-xs" role="button"
                         (click)="toggleSampleSelection(sampleMatch._id)">
                        <span *ngIf=" isSampleSelected(sampleMatch._id)" class="glyphicon glyphicon-minus"></span>
                        <span *ngIf="!isSampleSelected(sampleMatch._id)" class="glyphicon glyphicon-plus"></span>
                      </a>
                      <b>{{ sampleMatch._source['Sample Name'] }}</b>
                      <span *ngFor="let kv of filteredDistinctKeyValues(studyMatch.study._id, sampleMatch) | mapToIterable; let isLast = last">
                        <i>{{ kv.key }}</i>: {{ kv.val }}<span *ngIf="!isLast">, </span>
                      </span>

                      <div class="hovertext">
                        <div *ngFor="let kv of distinctKeyValues(studyMatch.study._id, sampleMatch) | mapToIterable">
                          <b>{{ kv.key }}</b>: {{ kv.val }}
                        </div>
                      </div>
                    </div>
                  </li>
                </ul>
              </div>
            </div>
            <div class="panel-footer">
              <div class="btn-group btn-group-xs" style="float:right">
                <pubmed-links [study]="studyMatch.study"></pubmed-links>
                <doi-links [study]="studyMatch.study"></doi-links>
                <a [href]="studyMatch.study._source['*Archive URL']">Download Archive</a>
                <a href="#" class="btn btn-default" role="button">PubMed</a>
                <a href="#" class="btn btn-default" role="button">DOI</a>
                <a href="#" class="btn btn-default" role="button"><span class="glyphicon glyphicon-download-alt"></span> Download</a>
              </div>
              <div class="clearfix"></div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <div class="col-xs-3 footer-fixed-bottom nav">
      <li>
        <a href="javascript:void(0)" (click)="clearFilters()">
          <span class="glyphicon glyphicon-ban-circle"></span> Clear Filters
        </a>
      </li>
    </div>
  </div>

</div>
